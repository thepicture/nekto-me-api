(()=>{"use strict";var e={636:function(e,t){var s=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function a(e){try{r(n.next(e))}catch(e){o(e)}}function c(e){try{r(n.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,c)}r((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{transpile(e){return s(this,void 0,void 0,(function*(){if(1===e.length)return(e.toUpperCase()+".").replaceAll("..",".");if(2==e.length&&/\p{Emoji}/gu.test(e))return e;if(0==(e=e.replaceAll(/(\u00a9|\u00ae|[\u2000-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff])/g,"")).trim().length)return"Угу.";let t=0,s=String(e.trim())[0].toUpperCase()+String(e.trim()).substring(1);for(let n=0;n<e.length;n++)"("===s[n]&&(t++,t<0&&(s=s.slice(0,n)+s.slice(n+1,s.length),n=0,t=0)),")"===s[n]&&(t--,t<0&&(s=s.slice(0,n)+s.slice(n+1,s.length),n=0,t=0));s=s.trim().replaceAll(/\s\s+/g," ").replaceAll(/\?\?+/g,"?").replaceAll(/\!\!+/g,"!").replaceAll(" !","!").replaceAll(" ?","?").replaceAll("?",".").replaceAll("!",".").replaceAll(/,,+/g,",").replaceAll(" ,",",").replaceAll(" .",".").replaceAll(/\.\.+/g,".");let n=!0;for(let e=0;e<s.length;e++)n&&/[a-zA-Zа-яА-Я]/.test(s[e])?(s=s.slice(0,e)+s[e].toUpperCase()+s.slice(e+1,s.length),n=!1):s=s.slice(0,e)+s[e].toLowerCase()+s.slice(e+1,s.length),"."===s[e]&&(n=!0);return(s+".").replace(/\s\s+/," ").replace(/\.\.+/,".")}))}}},737:function(e,t){var s=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function a(e){try{r(n.next(e))}catch(e){o(e)}}function c(e){try{r(n.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,c)}r((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{transpile(e){return s(this,void 0,void 0,(function*(){return Math.random()>.05?yield Promise.resolve(e):yield fetch("https://google-translate1.p.rapidapi.com/language/translate/v2",{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded",accept:"application/json","x-rapidapi-host":"google-translate1.p.rapidapi.com","x-rapidapi-key":"44aaaeef79msh75169124fb09b39p153dedjsnab8c1122a6a5"},body:new URLSearchParams({q:e,target:"en",source:"ru"})}).then((e=>e.json())).catch((t=>e)).then((e=>e.data.translations[0].translatedText)).catch((t=>e))}))}}},142:function(e,t,s){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(s(872)),o=n(s(953)),a=n(s(846)),c=n(s(158));setInterval((()=>document.body.scrollIntoView(!1)),1e3);const r=new i.default,l=new a.default("df3dc540-6d8a-48bf-98b2-d2ee6d8c814c","first",r,!0),d=new a.default("df3dc540-6d8a-48bf-98b2-d2ee6d8c814c","second",r,!1);l.connect(),d.connect();const u=new c.default(new o.default(l.socket,l.token,0,0)),h=new c.default(new o.default(d.socket,l.token,0,0));u.api=l,h.api=d,r.subscribe("firstapimessage",(e=>{h.send(e)})),r.subscribe("secondapimessage",(e=>{u.send(e)})),r.subscribe("firstapiwriting",(()=>{h.startTyping()})),r.subscribe("secondapiwriting",(()=>{u.startTyping()})),Window.bus=r;const f=document.querySelector("#btn-disconnect-1"),p=document.querySelector("#btn-disconnect-2"),m=document.querySelector("#btn-start-searching-1"),g=document.querySelector("#btn-start-searching-2"),_=WebSocket.prototype.send;window.sockets=[],WebSocket.prototype.send=function(...e){return-1===window.sockets.indexOf(this)&&window.sockets.push(this),_.call(this,...e)};const w=document.createElement("article");w.setAttribute("id","chat"),document.body.append(w),f.addEventListener("click",(()=>{l.disconnect()})),p.addEventListener("click",(()=>{d.disconnect()})),m.addEventListener("click",(()=>{u.startSearch()})),g.addEventListener("click",(()=>{h.startSearch()}))},872:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.functions={}}subscribe(e,t){this.functions[e]||(this.functions[e]=[]),this.functions[e].push(t)}notifyAll(e,t){const s=this.functions[e];s&&0!==s.length&&s.forEach((e=>{e(t)}))}}},670:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{}},298:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.socket=e}send(){this.socket.send("2")}}},777:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.socket=e}send(){this.socket.send('42["leave"]')}}},953:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,s=0,n=0){this.socket=e,this.token=t,this.myGenderCode=s,this.interlocutorGenderCode=n}send(){const e=["start_chat",this.myGenderCode,this.interlocutorGenderCode,"",!1,this.token,[13,65],this.token];this.socket.send(`423${JSON.stringify(e)}`)}}},276:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,s){this.socket=e,this.message=t,this.index=s}send(){this.socket.send(`42["user message","${this.message}",${this.index}]`)}}},291:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.socket=e}send(){this.socket.send('42["user write"]')}}},680:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.socket=e}send(){this.socket.send('420["validate"]')}}},846:function(e,t,s){var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function a(e){try{r(n.next(e))}catch(e){o(e)}}function c(e){try{r(n.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,c)}r((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(s(636)),a=i(s(737)),c=i(s(670)),r=i(s(298)),l=i(s(777)),d=i(s(953)),u=i(s(680));class h extends c.default{constructor(e,t,s,n){super(),this.isValidated=!1,this.PING_PONG_INTERVAL_MS=15e3,this.SEARCH_INTERVAL_MS=2e3,this.TIMEOUT_BEFORE_LEAVE_MS=4e3,this.ARTIFICIAL_THROTTLE_MS=500,this.isSearching=!1,this.token=e,this.alias=t,this.bus=s,this.isSelf=n}connect(){this.socket&&1===this.socket.readyState&&this.disconnect(),this.socket=new WebSocket("wss://xn--j1ailbaf.xn--p1ai/socket.io/?id=df3dc540-6d8a-48bf-98b2-d2ee6d8c814c&v=25&EIO=3&transport=websocket&guid="+ +Math.random()),this.socket.addEventListener("open",(()=>{this.informImAlive()})),this.socket.addEventListener("message",(e=>{this.isValidated||(new u.default(this.socket).send(),this.isValidated=!0),this.parse(e.data)}))}informImAlive(){this.socket&&1===this.socket.readyState&&(new r.default(this.socket).send(),setTimeout((()=>this.informImAlive()),this.PING_PONG_INTERVAL_MS))}disconnect(){this.socket&&(new l.default(this.socket).send(),this.socket.close())}parse(e){return n(this,void 0,void 0,(function*(){let t;const s=/\d+(({|\[).+)/;if(s.test(e))if(t=JSON.parse(s.exec(e)[1]),"user write"===t[0])this.bus&&this.alias&&this.bus.notifyAll(`${this.alias}apiwriting`,null);else if("user message"===t[0]&&"service"!==t[1]){let e=yield(new a.default).transpile(t[2]);e=yield(new o.default).transpile(e),console.log(`${this.alias}: ${t[2]}`),this.bus&&this.alias&&this.bus.notifyAll(`${this.alias}apimessage`,e);const s=document.createElement("div"),n=document.createElement("p");n.innerText=e,n.classList.add("message"),n.classList.add(this.isSelf?"self":"anon"),n.style.backgroundColor=`#${Number(2*this.currentChatGuid%256).toString(16)}${Number(3*this.currentChatGuid%256).toString(16)}${Number(4*this.currentChatGuid%256).toString(16)}`,s.appendChild(n),document.querySelector("#chat").append(s)}else"announcement"===t[0]?(console.log(`${this.alias} interlocutor quit.`),new l.default(this.socket).send(),yield new Promise((e=>setTimeout(e,Math.floor(this.TIMEOUT_BEFORE_LEAVE_MS*Math.random())))),new u.default(this.socket).send(),yield new Promise((e=>setTimeout(e,this.ARTIFICIAL_THROTTLE_MS))),new d.default(this.socket,this.token).send()):"online"===t[0]||(t[0]==="challenge".replace("e","a")?console.log("You must solve captcha"):"nicknames"===t[0]&&2===Object.getOwnPropertyNames(t[1]).length&&(this.currentChatGuid=+new Date,console.log(`${this.alias}: Connected to the dialogue`)))}))}}t.default=h},158:function(e,t,s){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(s(777)),o=n(s(953)),a=n(s(276)),c=n(s(291));t.default=class{constructor(e){this.mySendMessagesIndexCounter=0,this.searchRequest=e}startSearch(){this.searchRequest?this.searchRequest.send():new o.default(this.api.socket,this.api.token).send()}stopSearch(){throw new Error("Method not implemented.")}read(){throw new Error("Method not implemented.")}startTyping(){new c.default(this.api.socket).send()}stopTyping(){throw new Error("Method not implemented.")}send(e){new a.default(this.api.socket,e,this.mySendMessagesIndexCounter++).send()}closeDialog(){new i.default(this.api.socket).send()}}}},t={};!function s(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,s),o.exports}(142)})();